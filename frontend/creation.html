
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LAS2peer Calendar Service</title>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">

</head>
<body>

  <!-- Fixed navbar -->
  <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Calendar Service</a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Calendar Navigation</a></li>
          <li><a href="creation.html">Entry creation</a></li>
        </ul>
        <!-- OpenID Connect Button: add HTML element representing button -->
        <span id="signinButton">
          <span class="oidc-signin navbar-btn navbar-right btn-default"
                data-callback="signinCallback"
                data-name="OpenID Connect"
                data-logo="logo.png"
                data-size="sm"
                data-server="https://api.learning-layers.eu/o/oauth2"
                data-clientid="YOUR OIDC CLIENT ID HERE"
                data-scope="openid email profile">
          </span>
        </span>
      </div><!--/.nav-collapse -->
    </div>
  </div>



  <!-- Container for actual page content -->
  
<div class="container" style="margin-top:50px">
<div class="year" style="margin-top:0px">
 <form>
  Year:<br>
  <input type="text" name="year" id="year">
  <br>
</form> 
</div>
</div>

<div class="container" style="margin-top:10px">
  <label for="month">Select month:</label>
  <select class="form-control" id="creMon">
    <option>Januar</option>
    <option>February</option>
    <option>March</option>
    <option>April</option>
    <option>May</option>
    <option>June</option>
    <option>July</option>
    <option>August</option>
    <option>September</option>
    <option>October</option>
    <option>November</option>
    <option>December</option>
  </select>
</div>

<div class="container" style="margin-top:10px">
<div class="day" style="margin-top:0px">
 <form>
  Day:<br>
  <input type="text" name="day" id ="day">
  <br>
</form> 
</div>
</div>

<div class="container" style="margin-top:10px">
<div class="sminute" style="margin-top:0px">
 <form>
  Start time: (use both boxes)<br>
  <input type="text" name="shour" id ="shour"> : 
  <input type="text" name="sminute" id ="sminute"> 
  <br>
</form> 
</div>
</div>

<div class="container" style="margin-top:10px">
<div class="sminute" style="margin-top:0px">
 <form>
  End time: (use both boxes)<br>
  <input type="text" name="ehour" id ="ehour"> : 
  <input type="text" name="eminute" id ="eminute"> 
  <br>
</form> 
</div>
</div>

<div class="container" style="margin-top:10px">
<div class="title" style="margin-top:0px">
 <form>
  Your title:<br>
  <input type="text" name="title" id ="title">
  <br>
</form> 
</div>
</div>

<div class="container" style="margin-top:10px">
<div class="description" style="margin-top:0px">
 <form>
  Your description<br>
  <input type="text" name="description" id ="description">
  <br>
</form> 
</div>
</div>

<div class="container" style="margin-top:10px">
    <button onclick="createEntry();" class="btn btn-default"><span class="glyphicon glyphicon-hand-right"> Create Entry!</span></button>
    <p id="getExampleOutput"></p>
</div>

<div class="container" style="margin-top:10px">
    <button onclick="set();" class="btn btn-default"><span class="glyphicon glyphicon-hand-right"> Add start date</span></button>
    <p id="getExampleOutput"></p>
</div>

<div class="container" style="margin-top:10px">
    <button onclick="setEnd();" class="btn btn-default"><span class="glyphicon glyphicon-hand-right"> Add end date</span></button>
    <p id="getExampleOutput"></p>
</div>

<div class="container" style="margin-top:10px">
	    <form>
	  Amount of entries:<br>
	  <input type="text" name="amount" id ="occur">
 		 <br>
		</form> 
		

  <label for="interval">Select interval:</label>
  <select class="form-control" id="inval">
    <option>Weekly</option>
    <option>Bi-Weekly</option>
    <option>Monthly</option>
    <option>Bi-Monthly</option>
    <option>Quarterly</option>
    <option>Yearly</option>
  </select>
</div>

<div align="left">
<div class="container" style="margin-top:10px">
    <button onclick="interval();" class="btn btn-default"><span class="glyphicon glyphicon-hand-right">Create regular date</span></button>
    <p id="getExampleOutput"></p>
</div>
</div>

<div align="center" class="year" style="margin-top:0px">
 <form>
  <b> Import function: </b>
  <input type="file" id="myFile">
  <button type="button" onclick="process()">Upload Entry</button>
</form> 
</div>

  <!-- import jQuery for AJAX calls (must) -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.1.min.js"></script>

  <!-- import Bootstrap for responsive UI (must) -->
  <script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

  <!-- import JWS and JSRSASIGN (must) -->
  <script type="text/javascript" src="js/jws-2.0.min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/ext/base64-min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/base64x-1.1.min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/ext/jsbn-min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/ext/jsbn2-min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/asn1hex-1.1.min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/crypto-1.1.min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/ext/rsa-min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/ext/rsa2-min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/rsapem-1.1.min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/rsasign-1.2.min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/x509-1.1.min.js"></script>
  <script type="text/javascript" src="js/jsrsasign/crypto-1.1.min.js"></script>

  <!-- import OpenID Connect Button -->
  <script type="text/javascript">

    (function() {
      var po = document.createElement('script');
      po.type = 'text/javascript';
      po.async = true;
      po.src = 'js/oidc-button.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(po, s);
    })();

    // OpenID Connect Button: implement a callback function
    function signinCallback(result) {
      if(result === "success"){
        // authenticated

        // OpenID Connect user info
        console.log(oidc_userinfo);
        $("#uname").html(oidc_userinfo.name);
        $(".authenticated").removeClass("hidden");
      } else {
        // anonymous
      }
    }

  </script>

  <!-- import client library for service -->
  <script type="text/javascript" src="js/client.js"></script>

  <!-- instantiate and use the client library -->
  <script type="text/javascript">
    // create new instance of TemplateServiceClient, given its endpoint URL
    var client = new TemplateServiceClient("http://localhost:8080/");
    
    var id = 0;

    // function defined as response to a click on the first button (see below)
    function getExample() {
      client.getMethod(
        function(data,type) {
          // this is the success callback
          console.log(data);
          $("#getExampleOutput").html(data);
        },
        function(error) {
          // this is the error callback
          console.log(error);
          $("#getExampleOutput").html(error);
        }
      );
    }

    // function defined as response to a click on the second button (see below)
    function postExample(input) {
      client.postMethod(input,
        function(data,type) {
          // this is the success callback
          console.log(data);
          $("#postExampleOutput").html(data);
        },
        function(error) {
          // this is the error callback
          console.log(error);
          $("#postExampleOutput").html(error);
        }
      );
    }
    
    //function defined as a response to a click on a day in the calendar
    function getDay(year, month, day) {
    	client.getDay(year, month, day,
    	function(data,type) {
          // this is the success callback
          console.log(data);
          $("#postExampleOutput").html(data);
         },
         function(error) {
            // this is the error callback
           console.log(error);
           $("#postExampleOutput").html(error);
          }
        );
      }
    
    //function definied as a resposne to a button to create entries
      function createEntry(input) {
      client.create(document.getElementById('title').value, 
    		  document.getElementById('description').value,
    		  document.getElementById('year').value, 
        function(data,type) {
          // this is the success callback
          data = JSON.parse(data)
          id = data.entry_id;
          console.log(data);
          $("#postExampleOutput").html(data);
        },
        function(error) {
          // this is the error callback
          console.log(error);
          $("#postExampleOutput").html(error);
        }
      );
    }
      function set(input) {
      client.setStart(
    		  id,
    		  document.getElementById('year').value, 
    		  getMonth(document.getElementById('creMon')),
    		  document.getElementById('day').value,
    		  document.getElementById('shour').value,
    		  document.getElementById('sminute').value, 
    		  
		        function(data,type) {
		          // this is the success callback
		          console.log(data);
		          $("#postExampleOutput").html(data);
		        },
		        function(error) {
		          // this is the error callback
		          console.log(error);
		          $("#postExampleOutput").html(error);
		        }
		      );
      }
      
      //function defined to set end
      function setEnd(input) {
          client.setEnd(
        		  id,
        		  document.getElementById('year').value, 
        		  getMonth(document.getElementById('creMon')),
        		  document.getElementById('day').value,
        		  document.getElementById('ehour').value,
        		  document.getElementById('eminute').value, 
        		  
    		        function(data,type) {
    		          // this is the success callback
    		          console.log(data);
    		          $("#postExampleOutput").html(data);
    		        },
    		        function(error) {
    		          // this is the error callback
    		          console.log(error);
    		          $("#postExampleOutput").html(error);
    		        }
    		      );
          }
      
      //function defined to create entries on a weekly basis
      function interval(input) {
      client.createRegular(
    		  
    		  document.getElementById('title').value, 
    		  document.getElementById('description').value,
    		  document.getElementById('year').value, 
    		  getMonth(document.getElementById('creMon')),
    		  document.getElementById('day').value,
    		  document.getElementById('shour').value,
    		  document.getElementById('sminute').value, 
    		  document.getElementById('ehour').value,
    		  document.getElementById('eminute').value,
    		  getInterval(document.getElementById('inval').value),
    		  document.getElementById('occur').value,
    		     		  
        function(data,type) {
		          // this is the success callback
		          console.log(data);
		          $("#postExampleOutput").html(data);
		},
        function(error) {
          // this is the error callback
          console.log(error);
          $("#postExampleOutput").html(error);
        }
      );
    }
     
      //function to parse correct interval enum term
      function getInterval(term){
    	  if(term == "Weekly"){
    		  return "week";
    	  }
    	  if(term == "Monthly"){
    		  return "month";
    	  }
    	  if(term == "Yearly"){
    		  return "year";
    	  }
    	  if(term == "Quarterly"){
    		  return "quarter";
    	  }
    	  if(term == "Bi-Weekly"){
    		  return "biweek";
    	  }
    	  else{
    		  return "bimonth";
    	  }
      }
      
      //function to get ics file
      function process(){
      	var file = document.getElementById("myFile").files[0];
      	
      	if(file){
      	    getAsText(file);
      	  }
      	
      }
      
      //function to process ics file
      function getAsText(readFile){
      	var reader = new FileReader();
      	
      	// Read file into memory as UTF-16      
      	reader.onprogress = loaded;
      	
      	reader.readAsBinaryString(readFile);
      }
      
     function loaded(e){
  	   var result = e.target.result;
  	   
  	   //split calendar file by lines to extract info
  	   var lines = result.split('\n');
  	   
  	   //extract info
  	   for(var line = 0; line < lines.length; line++){
  		   
  		   if(lines[line].contains("DTSTART")){
  			   var start = lines[line];
  			   var splitting = start.split(":");
  			   //get line with stat date
  			   var sdate = splitting[1];
  			   var year = sdate.substr(0,4);
  			   document.getElementById("year").value = year;
  			   var monthstring = sdate.substr(4);
  			   var split = monthstring.substr(0,2);
  			   var month = parseInt(split) - 1;
  			   var day = monthstring.substr(2);
  			   document.getElementById('creMon').options.selectedIndex = month;
  			   
  			   var sday = sdate.substr(6,6);
  			   day = sday.substr(0,2); 
  			   document.getElementById('day').value = day;
  			   var sstart = sdate.substr(9,9);
  			   var shour = sstart.substr(0,2);
  			   sstart = sdate.substr(9,9);
  			   var sminute = sstart.substr(2,4);
  			   document.getElementById('shour').value = shour;
  			   sminute = sminute.substr(0,2);
  			   document.getElementById('sminute').value = sminute;
  		   }
  		   
  		   if(lines[line].contains("DTEND")){
  			   var end = lines[line];
  			   var splitting = end.split(":");
  			   //get line with end date
  			   var edate = splitting[1];
  			   edate = edate.substr(9);
  			   ehour = edate.substr(0,2);
  			   edate = splitting[1];
			   edate = edate.substr(9);
			   eminute = edate.substr(2,4);
			   eminute = eminute.substr(0,2);
  			   document.getElementById('ehour').value = ehour;
  			   document.getElementById('eminute').value = eminute;
  		   }
  		   
  		   if(lines[line].contains("SUMMARY")){
  			   var summary = lines[line];
  			   var splitting = summary.split(":");
  			   //get line with end date
  			   var title = splitting[1];
  			   document.getElementById('title').value = title;
  		   }
  		   
  		   if(lines[line].contains("DESCRIPTION")){
  			   var summary = lines[line];
  			   var splitting = summary.split(":");
  			   //get line with end date
  			   var description = splitting[1];
  			   document.getElementById('description').value = description;
  		   }
  	   }
  	   
     }
      
  </script>
</body>
</html>
